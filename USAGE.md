# 使用说明

## 插件功能
`koishi-plugin-stock` 是一个Koishi插件，包含四个主要功能：
1. 当用户发送"活跃市值"时，插件会自动从 http://stock.svip886.com/api/indexes 获取股市数据并回复给用户。
2. 当用户发送"异动 [股票代码]"时，插件会自动从 http://stock.svip886.com/api/analyze?code=[股票代码] 获取指定股票的异动分析数据并回复给用户。
3. 当用户发送"涨停看板"时，插件会自动下载 http://stock.svip886.com/api/limit_up.png 图片并回复给用户。
4. 当用户发送"选股 [策略名称]"时，插件会根据指定策略从 http://stock.svip886.com/api/dyq_select/[策略API名] 获取选股结果并回复给用户。

## 已完成的测试
- ✅ 插件代码成功编译
- ✅ API端点可访问（状态码200）
- ✅ API返回数据格式已确认（文本格式，非JSON）
- ✅ 插件结构符合Koishi标准

## API返回示例
### 活跃市值API返回格式：
```
活跃市值（0AMV）：225790.5（+1.13%）
创业板指（399006）：3282.48（-0.40%）
```

### 异动分析API返回格式：
```
股票名称: 航天发展
当前价格: 25.88
是否异动: 否
10天偏离: -0.15%
30天偏离: 17.96%
10天最低价: 25.88 (2026-01-21)
30天最低价: 20.25 (2025-12-11)
10天临界价格: 51.80 (100.15%)
30天临界价格: 62.74 (142.44%)
```

## 插件工作流程
### 活跃市值功能：
1. 用户在聊天中发送"活跃市值"
2. 插件收到消息后，向 http://stock.svip886.com/api/indexes 发起GET请求
3. 插件接收API返回的文本数据
4. 插件将数据格式化为"📊 活跃市值数据：\n\n[API返回内容]"并回复给用户

### 异动分析功能：
1. 用户在聊天中发送"异动 [股票代码]"（例如：异动 000547）
2. 插件解析出股票代码
3. 插件向 http://stock.svip886.com/api/analyze?code=[股票代码] 发起GET请求
4. 插件接收API返回的文本数据
5. 插件将数据格式化为"📈 股票 [股票代码] 异动分析：\n\n[API返回内容]"并回复给用户

## 集成到Koishi机器人
将此插件集成到Koishi机器人中的步骤：
1. 将整个项目复制到机器人的插件目录
2. 在Koishi控制台中启用此插件
3. 或者通过配置文件添加插件引用

## 故障排除
- 如果API请求失败，插件会返回"获取活跃市值数据失败，请稍后重试。"
- 确保机器人有网络访问权限以调用外部API